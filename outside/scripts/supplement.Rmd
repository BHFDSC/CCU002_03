---
title: Risk of myocarditis and pericarditis following COVID-19 vaccination in England and Wales
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

doses <- data.table::fread("../output/doses.csv")

df <- data.table::fread("../output/estimates.csv")
df$nation <- factor(df$nation, levels = c("All","England","Wales"))
df$dose <- factor(df$dose, levels = c("Dose 1","Dose 2"))
df$age_group <- factor(df$age_group, levels = c("All","<40","40-69","70+"))
df$sex <- factor(df$sex, levels = c("All","Male","Female"))
df$exposure <- factor(df$exposure, levels = c("BNT162b2","ChAdOx1-S"))
df$days_post_vaccination <- factor(df$days_post_vaccination, levels = c("0-13","14+"))

df1 <- data.table::fread("../output/waldtests.csv")

```

\newpage

# Contributions to this work

This work was conducted on behalf of the BHF Data Science Centre (Health Data Research UK) CVD-COVID-UK/COVID-IMPACT Consortium and the Longitudinal Health and Wellbeing and Data and Connectivity UK COVID-19 National Core Studies. Samantha Ip developed the analysis code and implemented the analysis in England; Fatemeh Torabi derived the dataset for Wales and implemented the analysis in Wales; and Venexia Walker derived the dataset for England, combined and visualised the results from both nations, and drafted the report. The work relied on the support of the CCU002 project group, members of which include: Angela Wood (University of Cambridge), Arun Karthikeyan Suseeladevi (University of Bristol), Ashley Akbari (Swansea University), Cathie Sudlow (BHF Data Science Centre), Emanuele Di Angelantonio (University of Cambridge), Efosa Omigie (NHS Digital), Fatemeh Torabi (Swansea University), Hoda Abbasizanjani (Swansea University), Jennifer Cooper (University of Bristol), Jonathan Sterne (University of Bristol), Rachel Denholm (University of Bristol), Rochelle Knight (University of Bristol), Sam Hollings (NHS Digital), Samantha Ip (University of Cambridge), Spencer Keene (University of Cambridge), Spiros Denaxas (University College London), Teri-Louise North (University of Bristol), Thomas Bolton (BHF Data Science Centre), Venexia Walker (University of Bristol) and William Whiteley (University of Edinburgh). The project was conceived by this group, all members of which contributed to the development of the protocol (https://github.com/BHFDSC/CCU002_03/blob/main/protocol/COVID%20vaccination%20and%20myocarditis%20and%20pericarditis.pdf). Members of the group also reviewed and discussed analysis results and their interpretation, including in the context of other relevant published studies.
 
# Funding

This work was supported by: the BHF Data Science Centre led by Health Data Research UK (BHF Grant no. SP/19/3/34678); the COVID-19 Longitudinal Health and Wellbeing National Core Study funded by the Medical Research Council [MC_PC_20030]; the Con-COV team funded by the Medical Research Council (grant number: MR/V028367/1); Health Data Research UK, which receives its core funding from the UK Medical Research Council, Engineering and Physical Sciences Research Council, Economic and Social Research Council, Department of Health and Social Care (England), Chief Scientist Office of the Scottish Government Health and Social Care Directorates, Health and Social Care Research and Development Division (Welsh Government), Public Health Agency (Northern Ireland), British Heart Foundation (BHF) and the Wellcome Trust; the Wales COVID-19 Evidence Centre, funded by Health and Care Research Wales; the ADR Wales programme of work, which is aligned to the priority themes as identified in the Welsh Government’s national strategy, Prosperity for All, and brings together data science experts at Swansea University Medical School, staff from the Wales Institute of Social and Economic Research, Data and Methods (WISERD) at Cardiff University and specialist teams within the Welsh Government to develop new evidence which supports Prosperity for All by using the SAIL Databank at Swansea University, to link and analyse anonymised data. ADR Wales is part of the Economic and Social Research Council (part of UK Research and Innovation) funded ADR UK (grant ES/S007393/1). SI was funded by the International Alliance for Cancer Early Detection, a partnership between Cancer Research UK C18081/A31373, Canary Center at Stanford University, the University of Cambridge, OHSU Knight Cancer Institute, University College London and the University of Manchester. VW was supported by the Medical Research Council Integrative Epidemiology Unit at the University of Bristol [MC_UU_00011/4] and the National Core Studies, an initiative funded by UKRI, NIHR and the Health and Safety Executive.

# Other acknowledgements

This work makes use of de-identified data held in NHS Digital’s TRE for England and the SAIL Databank for Wales, made available via the BHF Data Science Centre’s CVD-COVID-UK/COVID-IMPACT consortium. This work uses data provided by patients and collected by the NHS as part of their care and support. We would like to acknowledge all data providers who make health relevant data available for research.

\newpage

# Sample size

## Dose 1

```{r n_dose1}
knitr::kable(doses[doses$analysis=="Dose 1",c("exposure","England","Wales","total")], digits=2)
```

## Dose 2

```{r n_dose2}
knitr::kable(doses[doses$analysis=="Dose 2",c("exposure","England","Wales","total")], digits=2)
```

\newpage

# Estimates, overall

## Dose 1

```{r overall_dose1}
tmp <- df[df$dose=="Dose 1" & df$sex=="All" & df$age_group=="All",c("nation","exposure","days_post_vaccination","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$nation,tmp$exposure,tmp$days_post_vaccination),], digits=2)
```

## Dose 2

```{r overall_dose2}
tmp <- df[df$dose=="Dose 2" & df$sex=="All" & df$age_group=="All",c("nation","exposure","days_post_vaccination","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$nation,tmp$exposure,tmp$days_post_vaccination),], digits=2)
```

\newpage

# Estimates, by sex

Reported for England only due to insufficient events in the subgroups in Wales.

## Dose 1

```{r sex_dose1}
tmp <- df[df$dose=="Dose 1" & df$sex!="All" & df$age_group=="All",c("exposure","days_post_vaccination","sex","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination,tmp$sex),], digits=2)
```

## Dose 2

```{r sex_dose2}}
tmp <- df[df$dose=="Dose 2" & df$sex!="All" & df$age_group=="All",c("exposure","days_post_vaccination","sex","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination,tmp$sex),], digits=2)
```

\newpage

# Estimates, by age group

Reported for England only due to insufficient events in the subgroups in Wales.

## Dose 1

```{r age_dose1}
tmp <- df[df$dose=="Dose 1" & df$sex=="All" & df$age_group!="All",c("exposure","days_post_vaccination","age_group","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination,tmp$age_group),], digits=2)
```

## Dose 2

```{r age_dose2}
tmp <- df[df$dose=="Dose 2" & df$sex=="All" & df$age_group!="All",c("exposure","days_post_vaccination","age_group","estimate","conf.low","conf.high","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination,tmp$age_group),], digits=2)
```

\newpage

# Heterogeneity p-values

Reported for England only due to insufficient events in the subgroups in Wales.

## Dose 1

### Sex

```{r hetero_sex_dose1}
tmp <- df1[df1$dose=="Dose 1" & df1$interacting_feature=="Sex",c("exposure","days_post_vaccination","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination),], digits=2)
```

### Age group

```{r hetero_age_dose1}
tmp <- df1[df1$dose=="Dose 1" & df1$interacting_feature=="Age group",c("exposure","days_post_vaccination","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination),], digits=2)
```

## Dose 2

### Sex

```{r hetero_sex_dose2}
tmp <- df1[df1$dose=="Dose 2" & df1$interacting_feature=="Sex",c("exposure","days_post_vaccination","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination),], digits=2)
```

### Age group

```{r hetero_age_dose2}
tmp <- df1[df1$dose=="Dose 2" & df1$interacting_feature=="Age group",c("exposure","days_post_vaccination","p.value")]
knitr::kable(tmp[order(tmp$exposure,tmp$days_post_vaccination),], digits=2)
```